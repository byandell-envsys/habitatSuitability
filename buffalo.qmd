---
title: "hist"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import sys
print(sys.executable)
print(sys.version)
```

# Buffalo Grasslands Habitat Suitability

This project examines habitat suitability for [Blue Stem](https://greg.app/big-bluestem-soil/) in the [Buffalo Gap](https://www.fs.usda.gov/recarea/nebraska/recarea/?recid=30329) and [Oglala](https://www.fs.usda.gov/recarea/nebraska/recarea/?recid=30328) National Grasslands.
These grasslands contiguous, located in
[Oceti Sakowin Oyate](https://americanindian.si.edu/nk360/plains-belonging-nation/oceti-sakowin),
also known as the Lakota Nation or
Great Sioux Nation,
and in the US states of South Dakota and Nebraska.

Blue Stem, according to [Greg](https://greg.app/), "need well-drained, nutrient-rich soils. The best soil types for this grass are sandy loam or loamy soil, which provide the right balance of drainage and nutrients. Aim for an organic matter content of 5-10%. This range is crucial for optimal growth, as it enhances soil fertility and structure. The ideal pH range for Big Bluestem is between 6.0 and 7.0. This slightly acidic to neutral pH is essential for nutrient availability, ensuring your plants can absorb what they need to thrive."

[Gardners.com](https://www.gardeners.com/how-to/what-type-of-soil-do-you-have/9120.html#:~:text=Most%20common%20garden%20plants%20prefer,well%2Dadapted%20to%20clay%20soils.) has a [soil simplex figure](https://www.gardeners.com/globalassets/articles/gardening/2014content/9120-soil-texture-triangle-sample.png?$staticlink$), which puts sandy loam and loamy sand at 50-85% sand.

![](https://www.gardeners.com/globalassets/articles/gardening/2014content/9120-soil-texture-triangle-sample.png?$staticlink$){fig-align="center"}

I don't seem to have information on slope or aspect, but I have seen blue stem on flat areas and slopes.

### Project Specs

The project should compare

-   two grassland habitats: Buffalo Gap and Oglala National Grasslands
-   one species: Blue Stem
-   one soil measurement: percent sand, and maybe pH
-   two climate scenarios: (e.g. different time periods, different emission scenarios)
    -   [Relative concentration pathways (RCPs)](https://coastadapt.com.au/infographics/what-are-rcps) 4.5 (current) and 8.5 (worse case)
-   one elevation: slope
-   fuzzy model based on above description

For each grassland (start with one), conduct the following steps. These will be laid out in 1-4 separate notebooks per grassland; ideally, code form one grassland will be developed in a generic way with functions to be reusable ([DRY](https://www.getdbt.com/blog/guide-to-dry)).

Workflow details are currently in separate notebooks. Working document that contribute to this workflow are as follows.

-   [0_study_area](https://github.com/byandell-envsys/habitatSuitability/blob/main/0_study_area.ipynb)
-   [1_1_soil](https://github.com/byandell-envsys/habitatSuitability/blob/main/1_1_soil.ipynb)
-   [1_2_climate](https://github.com/byandell-envsys/habitatSuitability/blob/main/1_2_climate.ipynb)
-   [2_slope](https://github.com/byandell-envsys/habitatSuitability/blob/main/2_slope.ipynb)
-   [3_harmonize](https://github.com/byandell-envsys/habitatSuitability/blob/main/3_harmonize.ipynb)
-   [4_build](https://github.com/byandell-envsys/habitatSuitability/blob/main/4_build.ipynb)

### Pseudocode

The pseudocode below relies on routines I developed with guidance from course instructors and fellow students, organized in the package [landmapy](https://github.com/byandell-envsys/landmapy). Workflows cited above have more detail on use and initial plots.

-   0: GeoDataFrame `buffalo_gdf` is created in step 0 and then stored for later retrieval.
-   1-1: Soil variable is `mean` of `sand` at depth `100-200m` is created (ignoring `buffer` of `0.1`) with functions
    -   `buffalo_da = merge_soil(buffalo_gdf, "sand", "mean", "100_200")`
    -   `gdf_over_da(buffalo_gdf, buffalo_da)`
-   1-2: Climate variables are projections of precipation `pr` under representative concentration pathway scenarios `rcp45` and `rcp85` for years `2026-2030`.
    -   `maca_df = process_maca({'buffalo': buffalo_gdf},                             ['pr'], ['rcp85', 'rcp45'], [2026])`
    -   `maca_2027 = maca_year(maca_df, 0, 2027)` \# 0 = `rcp85`, 1 = `rcp45`
    -   `gdf_over_da(buffalo_gdf, maca_2027)`
-   2: Elevation variable `slope`
    -   `srtm_da = srtm_download(buffalo_gdf, elevation_dir, 0.1)`
    -   `slope_da = srtm_slope(srtm_da)`
    -   `gdf_over_da(buffalo_gdf, slope_da)`
-   3: Harmonize data
    -   Watch video and create harmonizing function(s)
-   4: Build fuzzy model
    -   use hill functions to transform harmonized DataArrays into 0-1 DataArrays
    -   multiply them together

## Create Buffalo GeoDataFrame

Proposed sites are two contiguous national grasslands located in Oceti Sakowin Oyate, also known as Great Lakota Nation and the US states of South Dakota and Nebraska. They are [Buffalo Gap National Grassland](https://www.fs.usda.gov/recarea/nebraska/recarea/?recid=30329) and [Oglala National Grassland](https://www.fs.usda.gov/recarea/nebraska/recarea/?recid=30328)

A GeoDataFrame `buffalo_gdf` is created and stored for later retrieval. See [0_study_area](https://github.com/byandell-envsys/habitatSuitability/blob/main/0_study_area.ipynb)

### Grassland References

-   [Buffalo Gap National Grassland](https://www.fs.usda.gov/recarea/nebraska/recarea/?recid=30329)
    -   [Recreation Area](https://www.fs.usda.gov/detail/r2/recreation?cid=stelprdb5389082)
    -   [Natural Atlas](https://naturalatlas.com/national-grasslands/buffalo-gap-2096999)
    -   [Data Download](https://data-usfs.hub.arcgis.com/datasets/usfs::national-grassland-units-feature-layer/explore?location=43.534637%2C-102.565490%2C8.34)
    -   (OBJECTID 186937, NATIONALGRASSLANDID 295518010328)\
-   [Oglala National Grassland](https://www.fs.usda.gov/recarea/nebraska/recarea/?recid=30328)
    -   [Visit](https://visitnebraska.com/harrison/oglala-national-grassland)
    -   [Data Download](https://data-usfs.hub.arcgis.com/datasets/usfs::national-grassland-units-feature-layer/explore?location=43.509639%2C-102.570535%2C8.36)
    -   (OBJECTID 186940, NATIONALGRASSLANDID 295521010328)

### Python Code

```{python}
# Define and create the project data directory
import os # Interoperable file paths
import pathlib # Find the home folder

data_dir = os.path.join(
    pathlib.Path.home(),
    'earth-analytics',
    'data',
    'habitat'
)
os.makedirs(data_dir, exist_ok=True)
data_dir
```

```{python}
import geopandas as gpd
grassland_url = data_dir + "/National_Grassland_Units_(Feature_Layer).geojson"
print(grassland_url)

grassland_gdf = gpd.read_file(grassland_url)
```

```{python}
from landmapy.redline import plot_redline

buffalo_gdf = grassland_gdf.loc[grassland_gdf['GRASSLANDNAME'].isin(
                                 ["Buffalo Gap National Grassland", "Oglala National Grassland"])]

plot_redline(buffalo_gdf)
```

## Soil and Climate Measures

```{python}
help(plot_redline)
```

### Sand Soil Measurement

Get and show `mean` of `sand` at depth `100-200m` with functions

-   `buffalo_da = merge_soil(buffalo_gdf, "sand", "mean", "100_200")`
-   `gdf_over_da(buffalo_gdf, buffalo_da)`

### Climate Precipitation Measure

Project precipation `pr` under representative concentration pathway scenarios `rcp45` and `rcp85` for years `2026-2030`.

-   `maca_df = process_maca({'buffalo': buffalo_gdf}, ['pr'], ['rcp85', 'rcp45'], [2026])`
-   `maca_2027 = maca_year(maca_df, 0, 2027)` \# 0 = `rcp85`, 1 = `rcp45`
-   `gdf_over_da(buffalo_gdf, maca_2027)`

## Slope Elevation variable `slope`

-   `srtm_da = srtm_download(buffalo_gdf, elevation_dir, 0.1)`
-   `slope_da = srtm_slope(srtm_da)`
-   `gdf_over_da(buffalo_gdf, slope_da)`

## Harmonize data

See [3_harmonize](https://github.com/byandell-envsys/habitatSuitability/blob/main/3_harmonize.ipynb).

## Fuzzy Model

-   use hill functions to transform harmonized DataArrays into 0-1 DataArrays
-   multiply them together

See [4_build](https://github.com/byandell-envsys/habitatSuitability/blob/main/4_build.ipynb)